const router = require('express').Router();
const User = require('../models/User');
const { getPrices } = require('../exchanges/coin-market-cap');

module.exports = router
    .get('/', getPrices, (req, res, next) => {
        const { topCount = 10 } = req.query;
        User.top(topCount, req.marketData)
            .then(accounts => res.json(accounts))
            .catch(next);
    });


    // [{"currencies": [{"name": "BTC", "quantity": 3542122930110464}, {"name": "ETH", "quantity": 7303479458529280}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e9114"}, {"currencies": [{"name": "BTC", "quantity": 4203534746648576}, {"name": "ETH", "quantity": 6501986362982400}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e9117"}, {"currencies": [{"name": "BTC", "quantity": 8073840502505472}, {"name": "ETH", "quantity": 3348201065152512}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e9113"}, {"currencies": [{"name": "BTC", "quantity": 7796476379922432}, {"name": "ETH", "quantity": 8690305737949184}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e9116"}, {"currencies": [{"name": "BTC", "quantity": 8271472139173888}, {"name": "ETH", "quantity": 918918006833152}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e9115"}, {"currencies": [{"name": "BTC", "quantity": 992882527830016}, {"name": "ETH", "quantity": 4701988560306176}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e911c"}, {"currencies": [{"name": "BTC", "quantity": 959494496452608}, {"name": "ETH", "quantity": 7320517405048832}], "exchange": "Fake Market", "user":"5bd0e956fc21d23b736e911a"}, {"currencies": [{"name": "BTC", "quantity": 1142769812766720}, {"name": "ETH", "quantity": 1561167346532352}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e9119"}, {"currencies": [{"name": "BTC", "quantity": 8279092017233920}, {"name": "ETH", "quantity": 7356543475384320}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e9118"}, {"currencies": [{"name": "BTC", "quantity": 4870796388335616}, {"name": "ETH", "quantity": 3658231238885376}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e911b"}, {"currencies": [{"name": "BTC", "quantity": 5571695943352320}, {"name": "ETH", "quantity": 36178594103296}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e911f"}, {"currencies": [{"name": "BTC", "quantity": 3835988465942528}, {"name": "ETH", "quantity": 3487686620872704}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e911e"}, {"currencies": [{"name": "BTC", "quantity": 8206121869246464}, {"name": "ETH", "quantity": 6765814061465600}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e9121"}, {"currencies": [{"name": "BTC", "quantity": 3058365594861568}, {"name": "ETH", "quantity": 1724961160953856}], "exchange":"Fake Market", "user": "5bd0e956fc21d23b736e9120"}, {"currencies": [{"name": "BTC", "quantity": 6691425961902080}, {"name": "ETH", "quantity": 1871470668021760}], "exchange": "Fake Market", "user": "5bd0e956fc21d23b736e911d"}]

